<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>World Cup View</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: #0f0122;
        color: white;
        margin: 0;
        padding: 0;
      }

      .section {
        padding: 2rem;
      }

      h2 {
        color: #ff5470;
        margin-bottom: 1rem;
      }

      /* GROUP STAGE STYLING */
      .group-stage-container {
        display: flex;
        gap: 1.5rem;
        overflow-x: auto;
        padding-bottom: 1rem;
        scroll-snap-type: x mandatory;
      }

      .group {
        flex: 0 0 300px;
        scroll-snap-align: start;
        background: linear-gradient(160deg, #1b0033, #280045);
        border-radius: 16px;
        padding: 1.2rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .group:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
      }

      .group h3 {
        font-size: 1.1rem;
        margin-bottom: 1rem;
        color: #ff77aa;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        text-align: center;
      }

      .match {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 0.8rem;
        margin-bottom: 0.7rem;
        text-align: center;
        width: 100%;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .match a {
        color: #85c1ff;
        font-weight: 600;
        text-decoration: none;
      }

      .match a:hover {
        text-decoration: underline;
      }

      .score {
        font-size: 1.2rem;
        font-weight: bold;
        color: #fff;
        margin: 0.3rem 0;
      }

      .live {
        background: red;
        padding: 0.2rem 0.5rem;
        border-radius: 12px;
        font-size: 0.7rem;
        animation: blink 1s infinite;
        margin-top: 2px;
      }

      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      /* KNOCKOUT BRACKET */
      .bracket {
        display: flex;
        justify-content: center;
        align-items: stretch;
        gap: 2rem;
        overflow-x: auto;
        padding: 2rem 0;
        min-height: 600px; /* Adjust as needed */
      }

      .round {
        display: flex;
        flex-direction: column;
        justify-content: space-around; /* Key part for pyramid look */
        align-items: center;
        flex: 1;
        min-width: 200px;
        background-color: #1a0033;
        padding: 1rem;
        border-radius: 10px;
        transition: all 0.3s ease;
      }

      .round h3 {
        color: #f3a712;
        margin-bottom: 0.5rem;
        text-align: center;
      }
    </style>
  </head>

  <body>
    <div class="section">
      <h2>Group Stage</h2>
      <div id="groupStage" class="group-stage-container"></div>
    </div>

    <div class="section" id="qualifiers">
      <h2>Qualified Teams</h2>
      <ul id="qualifiedTeams"></ul>
    </div>

    <div class="section" id="knockout">
      <h2>Knockout Rounds</h2>
      <div class="bracket" id="bracketView"></div>
    </div>

    <script>
      async function loadMatches() {
        const leagueId = new URLSearchParams(location.search).get("id");
        if (!leagueId) {
          alert("Missing league ID in URL (e.g., ?id=1)");
          return;
        }

        const res = await fetch(
          `http://localhost:8080/api/matches/byLeague/${leagueId}`
        );
        const matches = await res.json();

        const groupStage = document.getElementById("groupStage");
        const knockoutContainer = document.getElementById("bracketView");
        const groups = {};
        const rounds = {};
        const qualifiedTeams = new Set();

        matches.forEach((m) => {
          if (m.matchType === "GROUP_STAGE") {
            (groups[m.groupName] ||= []).push(m);
          } else if (m.matchType === "KNOCKOUT") {
            (rounds[m.roundOrder] ||= []).push(m);
          }
        });

        // Group stage rendering
        Object.entries(groups).forEach(([groupName, games]) => {
          const div = document.createElement("div");
          div.className = "group";
          div.innerHTML = `<h3>${groupName}</h3>`;
          games.forEach((match) => div.appendChild(renderMatch(match)));
          groupStage.appendChild(div);
        });

        // Temporary logic for qualified teams
        Object.values(groups)
          .flat()
          .slice(0, 8)
          .forEach((m) => qualifiedTeams.add(m.homeTeamName));
        const list = document.getElementById("qualifiedTeams");
        qualifiedTeams.forEach((t) => {
          const li = document.createElement("li");
          li.textContent = t;
          list.appendChild(li);
        });

        // Knockout bracket rendering
        const roundOrders = Object.keys(rounds).sort((a, b) => a - b);
        roundOrders.forEach((order, index) => {
          const div = document.createElement("div");
          div.className = "round";
          const width = Math.max(120, 200 - index * 20);
          div.style.minWidth = `${width}px`;
          div.innerHTML = `<h3>${rounds[order][0].stageLabel}</h3>`;
          rounds[order].forEach((match) => div.appendChild(renderMatch(match)));
          knockoutContainer.appendChild(div);
        });
      }

      function renderMatch(match) {
        const div = document.createElement("div");
        div.className = "match";

        const kickoff = new Date(match.kickoff);
        const dateTimeString = kickoff.toLocaleString("en-US", {
          weekday: "short",
          year: "numeric",
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });

        div.innerHTML = `
    <a href="/team.html?id=${match.homeTeamId}">${match.homeTeamName}</a>
    <div class="score">
      ${
        match.status === "COMPLETED" || match.status === "ONGOING"
          ? `${match.homeScore} - ${match.awayScore}`
          : dateTimeString
      }
      ${match.status === "ONGOING" ? '<div class="live">LIVE</div>' : ""}
    </div>
    <a href="/team.html?id=${match.awayTeamId}">${match.awayTeamName}</a>
    <a href="/match.html?id=${
      match.id
    }" style="font-size:0.75rem; color:#aaa; margin-top:4px;">View</a>
  `;
        return div;
      }

      loadMatches();
    </script>
  </body>
</html>
